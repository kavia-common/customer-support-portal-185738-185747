{"is_source_file": true, "format": "Python", "description": "This file sets up the testing environment for the customer support portal backend. It configures test database, overrides dependencies, creates fixtures for database sessions and test clients, and provides helper functions for user registration and authentication tokens.", "external_files": ["src.api.main", "src.core.config", "src.db.session", "src.core.security"], "external_methods": ["fastapi.testclient.TestClient", "sqlalchemy.create_engine", "sqlalchemy.orm.sessionmaker", "src.db.session.Base.metadata.create_all", "src.db.session.Base.metadata.drop_all"], "published": [], "classes": [], "methods": [{"name": "override_get_db()", "description": "Provides a test database session that yields a database connection and closes it after use.", "scope": "", "scopeKind": ""}, {"name": "setup_database()", "description": "Creates database tables before tests start and drops them afterward.", "scope": "", "scopeKind": ""}, {"name": "Session db()", "description": "Provides a database session for individual tests, handling commit, rollback, and closure.", "scope": "", "scopeKind": ""}, {"name": "TestClient client()", "description": "Creates and provides a FastAPI test client for sending test requests.", "scope": "", "scopeKind": ""}, {"name": "_register_user(client: TestClient, email: str, password: str = \"password123\", is_agent: bool = False)", "description": "Helper function to register a new user and retrieve their JWT access token.", "scope": "", "scopeKind": ""}, {"name": "str agent_token(client: TestClient)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,str] auth_headers_agent(agent_token: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,str] auth_headers_customer(customer_token: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str customer_token(client: TestClient)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["os.environ.__setitem__", "create_engine", "sessionmaker", "Base.metadata.create_all", "Base.metadata.drop_all", "app.dependency_overrides.get_db", "TestClient", "client.post"], "search-terms": ["conftest", "pytest fixtures", "test database setup", "FastAPI test client", "user registration helper"], "state": 2, "file_id": 15, "knowledge_revision": 40, "git_revision": "", "ctags": [{"_type": "tag", "name": "TEST_DB_URL", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^TEST_DB_URL = \"sqlite:\\/\\/\\/.\\/test.db\"  # file-backed sqlite to persist across sessions in same/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "TestingSessionLocal", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^TestingSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_register_user", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^def _register_user(client: TestClient, email: str, password: str = \"password123\", is_agent: bool/", "language": "Python", "kind": "function", "signature": "(client: TestClient, email: str, password: str = \"password123\", is_agent: bool = False)"}, {"_type": "tag", "name": "agent_token", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^def agent_token(client: TestClient) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(client: TestClient)"}, {"_type": "tag", "name": "auth_headers_agent", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^def auth_headers_agent(agent_token: str) -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "(agent_token: str)"}, {"_type": "tag", "name": "auth_headers_customer", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^def auth_headers_customer(customer_token: str) -> Dict[str, str]:$/", "language": "Python", "typeref": "typename:Dict[str,str]", "kind": "function", "signature": "(customer_token: str)"}, {"_type": "tag", "name": "client", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^def client() -> TestClient:$/", "language": "Python", "typeref": "typename:TestClient", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "customer_token", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^def customer_token(client: TestClient) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(client: TestClient)"}, {"_type": "tag", "name": "db", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^def db() -> Session:$/", "language": "Python", "typeref": "typename:Session", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "engine", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^engine = create_engine(TEST_DB_URL, connect_args={\"check_same_thread\": False})$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "override_get_db", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^def override_get_db():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "setup_database", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/tests/conftest.py", "pattern": "/^def setup_database():$/", "language": "Python", "kind": "function", "signature": "()"}], "hash": "1098c636f4336f53014f9f9cf121f94e", "format-version": 4, "code-base-name": "customer_service_backend", "filename": "customer_service_backend/src/tests/conftest.py", "fields": [{"name": "TEST_DB_URL = \"sqlite:\\/\\/\\/.\\/test.db\"  # file-backed sqlite to persist across sessions in same/", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "TestingSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "engine = create_engine(TEST_DB_URL, connect_args={\"check_same_thread\": False})", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"40": ""}]}