{"is_source_file": true, "format": "Python", "description": "This Python source file defines API endpoints for managing support tickets within a customer support portal. It uses FastAPI to define routes for creating, listing, retrieving, and updating tickets. The code incorporates role-based access control, interacting with SQLAlchemy ORM models and schemas to process ticket data.", "external_files": ["src/core/security", "src/db/models", "src/db/schemas", "src/db/session"], "external_methods": ["get_current_user", "require_agent", "get_db"], "published": ["router"], "classes": [{"name": "APIRouter", "description": "FastAPI's router object used to define API endpoints for tickets."}], "methods": [{"name": "create_ticket(payload: TicketCreate, current: User = Depends(get_current_user), db: Session = Depends(get_db))", "description": "Creates a new support ticket, ensuring the user has permission and assigning initial status 'open'.", "scope": "", "scopeKind": ""}, {"name": "list_tickets( status: Optional[str] = Query(None, description=\"Filter by status\"), current: User = Depends(get_current_user), db: Session = Depends(get_db), )", "description": "Lists tickets with optional filtering by status, showing only user's tickets if not an agent.", "scope": "", "scopeKind": ""}, {"name": "get_ticket(ticket_id: int, current: User = Depends(get_current_user), db: Session = Depends(get_db))", "description": "Retrieves a specific ticket by ID, with access control based on user role.", "scope": "", "scopeKind": ""}, {"name": "update_ticket(ticket_id: int, payload: TicketUpdate, current: User = Depends(get_current_user), db: Session = Depends(get_db))", "description": "Updates fields of an existing ticket, with role-based permissions for modifying specific fields.", "scope": "", "scopeKind": ""}], "calls": ["get_current_user()", "require_agent()", "get_db()", "db.query(Ticket)", "db.add(ticket)", "db.commit()", "db.refresh(ticket)"], "search-terms": ["ticket creation endpoint", "ticket role-based access control", "ticket listing", "ticket retrieval", "ticket update", "FastAPI tickets", "SQLAlchemy Ticket model"], "state": 2, "file_id": 12, "knowledge_revision": 27, "git_revision": "", "ctags": [{"_type": "tag", "name": "create_ticket", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^def create_ticket(payload: TicketCreate, current: User = Depends(get_current_user), db: Session /", "language": "Python", "kind": "function", "signature": "(payload: TicketCreate, current: User = Depends(get_current_user), db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_ticket", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^def get_ticket(ticket_id: int, current: User = Depends(get_current_user), db: Session = Depends(/", "language": "Python", "kind": "function", "signature": "(ticket_id: int, current: User = Depends(get_current_user), db: Session = Depends(get_db))"}, {"_type": "tag", "name": "list_tickets", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^def list_tickets($/", "language": "Python", "kind": "function", "signature": "( status: Optional[str] = Query(None, description=\"Filter by status\"), current: User = Depends(get_current_user), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^router = APIRouter(prefix=\"\\/tickets\", tags=[\"tickets\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_ticket", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^def update_ticket(ticket_id: int, payload: TicketUpdate, current: User = Depends(get_current_use/", "language": "Python", "kind": "function", "signature": "(ticket_id: int, payload: TicketUpdate, current: User = Depends(get_current_user), db: Session = Depends(get_db))"}], "hash": "29493730736acffd413ab5fb8bdf3477", "format-version": 4, "code-base-name": "customer_service_backend", "filename": "customer_service_backend/src/api/routers_tickets.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/tickets\", tags=[\"tickets\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"27": ""}]}