{"is_source_file": true, "format": "Python", "description": "This file defines API routes for managing support tickets within a customer support portal. It includes endpoints for creating, listing, retrieving, and updating tickets, with role-based access control enforcement via dependency injection. The routes utilize FastAPI for request handling and SQLAlchemy ORM for database interactions.", "external_files": ["src/core/security", "src/db/models", "src/db/schemas", "src/db/session"], "external_methods": ["get_current_user (from src.core.security)", "get_db (from src.db.session)"], "published": ["router"], "classes": [{"name": "Ticket", "description": "ORM model representing a support ticket."}, {"name": "User", "description": "ORM model representing a user in the system."}], "methods": [{"name": "create_ticket(payload: TicketCreate, current: User = Depends(get_current_user), db: Session = Depends(get_db))", "description": "Creates a new support ticket with data validated via TicketCreate schema.", "scope": "", "scopeKind": ""}, {"name": "list_tickets( status: Optional[str] = Query(None, description=\"Filter by status\"), current: User = Depends(get_current_user), db: Session = Depends(get_db), )", "description": "Retrieves a list of tickets, filtering by status and user role.", "scope": "", "scopeKind": ""}, {"name": "get_ticket(ticket_id: int, current: User = Depends(get_current_user), db: Session = Depends(get_db))", "description": "Retrieves a specific ticket by ID, with access control based on user role.", "scope": "", "scopeKind": ""}, {"name": "update_ticket(ticket_id: int, payload: TicketUpdate, current: User = Depends(get_current_user), db: Session = Depends(get_db))", "description": "Updates ticket details with role-based constraints; allows only specific fields for customers and full updates for agents.", "scope": "", "scopeKind": ""}], "calls": ["db.query(Ticket)", "db.add(ticket)", "db.commit()", "db.refresh(ticket)", "db.query(Ticket).filter(Ticket.id == ticket_id).first()", "db.query(Ticket).filter(Ticket.status == status)"], "search-terms": ["API router for tickets", "FastAPI ticket endpoints", "Ticket creation and update", "RBAC ticket access"], "state": 2, "file_id": 12, "knowledge_revision": 35, "git_revision": "4411f5d2658459063e1bf3aee01e83bd50a202da", "revision_history": [{"27": ""}, {"35": "4411f5d2658459063e1bf3aee01e83bd50a202da"}], "ctags": [{"_type": "tag", "name": "create_ticket", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^def create_ticket(payload: TicketCreate, current: User = Depends(get_current_user), db: Session /", "language": "Python", "kind": "function", "signature": "(payload: TicketCreate, current: User = Depends(get_current_user), db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_ticket", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^def get_ticket(ticket_id: int, current: User = Depends(get_current_user), db: Session = Depends(/", "language": "Python", "kind": "function", "signature": "(ticket_id: int, current: User = Depends(get_current_user), db: Session = Depends(get_db))"}, {"_type": "tag", "name": "list_tickets", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^def list_tickets($/", "language": "Python", "kind": "function", "signature": "( status: Optional[str] = Query(None, description=\"Filter by status\"), current: User = Depends(get_current_user), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^router = APIRouter(prefix=\"\\/tickets\", tags=[\"tickets\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_ticket", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/api/routers_tickets.py", "pattern": "/^def update_ticket(ticket_id: int, payload: TicketUpdate, current: User = Depends(get_current_use/", "language": "Python", "kind": "function", "signature": "(ticket_id: int, payload: TicketUpdate, current: User = Depends(get_current_user), db: Session = Depends(get_db))"}], "hash": "03a9dff6089a1c084a4ad59274f83b2c", "format-version": 4, "code-base-name": "customer_service_backend", "filename": "customer_service_backend/src/api/routers_tickets.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/tickets\", tags=[\"tickets\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}