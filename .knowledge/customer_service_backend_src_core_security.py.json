{"is_source_file": true, "format": "Python", "description": "This file implements security-related functionalities for a FastAPI application, including password hashing, JWT token creation and decoding, and user authentication helpers.", "external_files": ["src.core.config", "src.db.models", "src.db.session"], "external_methods": ["get_settings", "User", "get_db"], "published": ["verify_password", "get_password_hash", "create_access_token", "decode_token", "get_current_user", "require_agent", "try_auth_optional"], "classes": [{"name": "TokenData", "description": "Pydantic model representing the payload of a JWT token, including user identification and expiration data."}], "methods": [{"name": "bool verify_password(plain_password: str, hashed_password: str)", "description": "Verifies a plain password against a stored hashed password.", "scope": "", "scopeKind": ""}, {"name": "str get_password_hash(password: str)", "description": "Hashes a plain password for secure storage.", "scope": "", "scopeKind": ""}, {"name": "str create_access_token( data: dict, secret_key: Optional[str] = None, expires_minutes: Optional[int] = None, algorithm: str = \"HS256\", )", "description": "Creates a signed JWT token with optional expiration, using provided data and secret key.", "scope": "", "scopeKind": ""}, {"name": "TokenData decode_token(token: str)", "description": "Decodes a JWT token and returns the payload as a TokenData instance, raising HTTPException if invalid.", "scope": "", "scopeKind": ""}, {"name": "User get_current_user( token: str = Depends(oauth2_scheme), db: Session = Depends(get_db) )", "description": "FastAPI dependency to retrieve the current authenticated user based on JWT token.", "scope": "", "scopeKind": ""}, {"name": "User require_agent(user: User = Depends(get_current_user))", "description": "Ensures that the current user has agent role; raises 403 otherwise.", "scope": "", "scopeKind": ""}, {"name": "Tuple[Optional[User],Optional[TokenData]] try_auth_optional(token: Optional[str])", "description": "Attempts to decode a token if present, for optional authentication scenarios, returning user and token data when available.", "scope": "", "scopeKind": ""}], "calls": ["get_settings()", "jwt.encode()", "jwt.decode()", "db.query()", "User.id", "User.email", "User.is_active"], "search-terms": ["JWT", "password hashing", "OAuth2PasswordBearer", "FastAPI security", "decode_token", "create_access_token", "get_current_user"], "state": 2, "file_id": 9, "knowledge_revision": 21, "git_revision": "", "ctags": [{"_type": "tag", "name": "TokenData", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^class TokenData(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "create_access_token", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def create_access_token($/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "( data: dict, secret_key: Optional[str] = None, expires_minutes: Optional[int] = None, algorithm: str = \"HS256\", )"}, {"_type": "tag", "name": "decode_token", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def decode_token(token: str) -> TokenData:$/", "language": "Python", "typeref": "typename:TokenData", "kind": "function", "signature": "(token: str)"}, {"_type": "tag", "name": "exp", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^    exp: int = Field(..., description=\"Expiration timestamp (epoch seconds)\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TokenData", "scopeKind": "class"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def get_current_user($/", "language": "Python", "typeref": "typename:User", "kind": "function", "signature": "( token: str = Depends(oauth2_scheme), db: Session = Depends(get_db) )"}, {"_type": "tag", "name": "get_password_hash", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def get_password_hash(password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(password: str)"}, {"_type": "tag", "name": "is_agent", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^    is_agent: bool = Field(..., description=\"Whether the user is an agent\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "TokenData", "scopeKind": "class"}, {"_type": "tag", "name": "oauth2_scheme", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"\\/auth\\/login\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "pwd_context", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "require_agent", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def require_agent(user: User = Depends(get_current_user)) -> User:$/", "language": "Python", "typeref": "typename:User", "kind": "function", "signature": "(user: User = Depends(get_current_user))"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^    sub: str = Field(..., description=\"User email as subject\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TokenData", "scopeKind": "class"}, {"_type": "tag", "name": "try_auth_optional", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def try_auth_optional(token: Optional[str]) -> Tuple[Optional[User], Optional[TokenData]]:$/", "language": "Python", "typeref": "typename:Tuple[Optional[User],Optional[TokenData]]", "kind": "function", "signature": "(token: Optional[str])"}, {"_type": "tag", "name": "user_id", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^    user_id: int = Field(..., description=\"User ID\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TokenData", "scopeKind": "class"}, {"_type": "tag", "name": "verify_password", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def verify_password(plain_password: str, hashed_password: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(plain_password: str, hashed_password: str)"}], "hash": "8a8ac3e8ddc4211d52016845aaefc9ec", "format-version": 4, "code-base-name": "customer_service_backend", "filename": "customer_service_backend/src/core/security.py", "fields": [{"name": "int exp", "scope": "TokenData", "scopeKind": "class", "description": "unavailable"}, {"name": "bool is_agent", "scope": "TokenData", "scopeKind": "class", "description": "unavailable"}, {"name": "oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"\\/auth\\/login\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str sub", "scope": "TokenData", "scopeKind": "class", "description": "unavailable"}, {"name": "int user_id", "scope": "TokenData", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"21": ""}]}