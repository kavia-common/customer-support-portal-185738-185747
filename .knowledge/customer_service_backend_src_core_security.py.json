{"is_source_file": true, "format": "Python", "description": "This Python source file provides security-related utilities for a FastAPI backend, including password hashing, JWT token creation and validation, and user authentication dependencies.", "external_files": ["src/core/config.py", "src/db/models.py", "src/db/session.py"], "external_methods": ["get_settings", "User.query", "get_db", "jwt.encode", "jwt.decode"], "published": ["verify_password", "get_password_hash", "create_access_token", "decode_token", "get_current_user", "require_agent", "try_auth_optional"], "classes": [{"name": "TokenData", "description": "Model representing the payload of a JWT token, including user identification and expiration info."}], "methods": [{"name": "bool verify_password(plain_password: str, hashed_password: str)", "description": "Verifies a plain password against a hashed password, guarding against bcrypt's 72-byte limit.", "scope": "", "scopeKind": ""}, {"name": "str get_password_hash(password: str)", "description": "Hashes a plaintext password using bcrypt, raising errors if input is invalid or too long.", "scope": "", "scopeKind": ""}, {"name": "str create_access_token( data: dict, secret_key: Optional[str] = None, expires_minutes: Optional[int] = None, algorithm: str = \"HS256\", )", "description": "Generates a signed JWT with configurable expiration, including claims from provided data.", "scope": "", "scopeKind": ""}, {"name": "TokenData decode_token(token: str)", "description": "Decodes and validates a JWT, returning the token data or raising an HTTPException if invalid.", "scope": "", "scopeKind": ""}, {"name": "User get_current_user( token: str = Depends(oauth2_scheme), db: Session = Depends(get_db) )", "description": "FastAPI dependency that retrieves the authenticated user based on JWT token, ensuring they are active.", "scope": "", "scopeKind": ""}, {"name": "User require_agent(user: User = Depends(get_current_user))", "description": "Ensures the current user has an agent role, otherwise raises a 403.", "scope": "", "scopeKind": ""}, {"name": "Tuple[Optional[User],Optional[TokenData]] try_auth_optional(token: Optional[str])", "description": "Attempts to decode an optional JWT token, returns user data if valid, or None if not.", "scope": "", "scopeKind": ""}], "calls": ["get_settings()", "jwt.encode()", "jwt.decode()", "db.query()"], "search-terms": ["security utilities", "JWT token handling", "password hashing", "FastAPI dependencies", "OAuth2PasswordBearer", "TokenData", "verify_password", "get_password_hash", "create_access_token"], "state": 2, "file_id": 9, "knowledge_revision": 53, "git_revision": "4411f5d2658459063e1bf3aee01e83bd50a202da", "revision_history": [{"21": ""}, {"51": "4411f5d2658459063e1bf3aee01e83bd50a202da"}, {"52": "4411f5d2658459063e1bf3aee01e83bd50a202da"}, {"53": "4411f5d2658459063e1bf3aee01e83bd50a202da"}], "ctags": [{"_type": "tag", "name": "TokenData", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^class TokenData(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_BCRYPT_MAX_BYTES", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^_BCRYPT_MAX_BYTES = 72$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_access_token", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def create_access_token($/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "( data: dict, secret_key: Optional[str] = None, expires_minutes: Optional[int] = None, algorithm: str = \"HS256\", )"}, {"_type": "tag", "name": "decode_token", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def decode_token(token: str) -> TokenData:$/", "language": "Python", "typeref": "typename:TokenData", "kind": "function", "signature": "(token: str)"}, {"_type": "tag", "name": "exp", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^    exp: int = Field(..., description=\"Expiration timestamp (epoch seconds)\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TokenData", "scopeKind": "class"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def get_current_user($/", "language": "Python", "typeref": "typename:User", "kind": "function", "signature": "( token: str = Depends(oauth2_scheme), db: Session = Depends(get_db) )"}, {"_type": "tag", "name": "get_password_hash", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def get_password_hash(password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(password: str)"}, {"_type": "tag", "name": "is_agent", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^    is_agent: bool = Field(..., description=\"Whether the user is an agent\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "TokenData", "scopeKind": "class"}, {"_type": "tag", "name": "oauth2_scheme", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"\\/auth\\/login\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "pwd_context", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "require_agent", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def require_agent(user: User = Depends(get_current_user)) -> User:$/", "language": "Python", "typeref": "typename:User", "kind": "function", "signature": "(user: User = Depends(get_current_user))"}, {"_type": "tag", "name": "sub", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^    sub: str = Field(..., description=\"User email as subject\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TokenData", "scopeKind": "class"}, {"_type": "tag", "name": "try_auth_optional", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def try_auth_optional(token: Optional[str]) -> Tuple[Optional[User], Optional[TokenData]]:$/", "language": "Python", "typeref": "typename:Tuple[Optional[User],Optional[TokenData]]", "kind": "function", "signature": "(token: Optional[str])"}, {"_type": "tag", "name": "user_id", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^    user_id: int = Field(..., description=\"User ID\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "TokenData", "scopeKind": "class"}, {"_type": "tag", "name": "verify_password", "path": "/home/kavia/workspace/code-generation/customer-support-portal-185738-185747/customer_service_backend/src/core/security.py", "pattern": "/^def verify_password(plain_password: str, hashed_password: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(plain_password: str, hashed_password: str)"}], "hash": "65bd36aa6a855ba9234fcaef49474cbd", "format-version": 4, "code-base-name": "customer_service_backend", "filename": "customer_service_backend/src/core/security.py", "fields": [{"name": "_BCRYPT_MAX_BYTES = 72", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "int exp", "scope": "TokenData", "scopeKind": "class", "description": "unavailable"}, {"name": "bool is_agent", "scope": "TokenData", "scopeKind": "class", "description": "unavailable"}, {"name": "oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"\\/auth\\/login\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str sub", "scope": "TokenData", "scopeKind": "class", "description": "unavailable"}, {"name": "int user_id", "scope": "TokenData", "scopeKind": "class", "description": "unavailable"}]}